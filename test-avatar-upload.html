<!DOCTYPE html>
<html>
  <head>
    <title>Avatar Upload Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .upload-area {
        border: 2px dashed #ccc;
        padding: 40px;
        text-align: center;
        margin: 20px 0;
        border-radius: 8px;
      }
      .upload-area.dragover {
        border-color: #007bff;
        background-color: #f8f9fa;
      }
      .preview {
        max-width: 200px;
        max-height: 200px;
        margin: 20px 0;
      }
      .result {
        margin: 20px 0;
        padding: 10px;
        border-radius: 4px;
      }
      .success {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <h1>Avatar Upload Test</h1>

    <div class="upload-area" id="uploadArea">
      <p>Drag and drop an image here or click to select</p>
      <input
        type="file"
        id="fileInput"
        accept="image/*"
        style="display: none"
      />
      <button onclick="document.getElementById('fileInput').click()">
        Choose File
      </button>
    </div>

    <div id="preview"></div>
    <div id="result"></div>

    <script>
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const preview = document.getElementById("preview");
      const result = document.getElementById("result");

      // Note: This is a test file. In production, you would use proper authentication
      const testToken = "test_token"; // Replace with actual token

      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFile(files[0]);
        }
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          handleFile(e.target.files[0]);
        }
      });

      function handleFile(file) {
        // Show preview
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.innerHTML = `<img src="${e.target.result}" class="preview" alt="Preview">`;
        };
        reader.readAsDataURL(file);

        // Upload file
        uploadFile(file);
      }

      async function uploadFile(file) {
        const formData = new FormData();
        formData.append("avatar", file);

        try {
          result.innerHTML = '<div class="result">Uploading...</div>';

          const response = await fetch("/api/profile/upload-avatar", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${testToken}`,
            },
            body: formData,
          });

          const data = await response.json();

          if (response.ok) {
            result.innerHTML = `<div class="result success">Upload successful! URL: ${data.data.url}</div>`;
          } else {
            result.innerHTML = `<div class="result error">Upload failed: ${data.error}</div>`;
          }
        } catch (error) {
          result.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
        }
      }
    </script>
  </body>
</html>
